import{_ as t,r as o,o as p,c as l,a as n,b as a,d as e,e as i}from"./app-2H8C6pDE.js";const c={},d=i(`<h1 id="ğŸ³-claude-tools-æœ¬åœ°å¤§æ¨¡å‹-docker-é›†æˆæ¶æ„" tabindex="-1"><a class="header-anchor" href="#ğŸ³-claude-tools-æœ¬åœ°å¤§æ¨¡å‹-docker-é›†æˆæ¶æ„" aria-hidden="true">#</a> ğŸ³ Claude Tools + æœ¬åœ°å¤§æ¨¡å‹ Docker é›†æˆæ¶æ„</h1><blockquote><p>åŸºäº Docker å®¹å™¨åŒ–çš„ Claude Tools ä¸æœ¬åœ°å¤§æ¨¡å‹æ— ç¼é›†æˆæ–¹æ¡ˆ</p></blockquote><h2 id="ğŸ“–-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ğŸ“–-æ¦‚è¿°" aria-hidden="true">#</a> ğŸ“– æ¦‚è¿°</h2><p>è¿™æ˜¯ä¸€ä¸ªä¼ä¸šçº§AIå·¥å…·é“¾æ¶æ„ï¼Œå°† Claude Tools çš„å¼ºå¤§èƒ½åŠ›ä¸ Docker å®¹å™¨åŒ–éƒ¨ç½²çš„æœ¬åœ°å¤§æ¨¡å‹å®Œç¾ç»“åˆï¼Œå®ç°<strong>é›¶é…ç½®éƒ¨ç½²</strong>ã€<strong>è·¨å¹³å°å…¼å®¹</strong>ã€<strong>ç”Ÿäº§çº§ç¨³å®šæ€§</strong>çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="ğŸ—ï¸-ç³»ç»Ÿæ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#ğŸ—ï¸-ç³»ç»Ÿæ¶æ„å›¾" aria-hidden="true">#</a> ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾</h2><h3 id="æ¶æ„ç»„ä»¶æ€»è§ˆ" tabindex="-1"><a class="header-anchor" href="#æ¶æ„ç»„ä»¶æ€»è§ˆ" aria-hidden="true">#</a> æ¶æ„ç»„ä»¶æ€»è§ˆ</h3><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin:20px 0;"><div style="background:#e1f5fe;border:2px solid #01579b;border-radius:8px;padding:15px;"><h4 style="margin-top:0;color:#01579b;">ğŸ¤– Claude Tools ç”Ÿæ€</h4><div style="margin:10px 0;">ğŸ“± Claude Code CLI<br><small>ç”¨æˆ·äº¤äº’ç•Œé¢</small></div><div style="margin:10px 0;">ğŸ”§ å·¥å…·è°ƒç”¨å±‚<br><small>API Bridge</small></div><div style="margin:10px 0;">ğŸ¯ æœ¬åœ°LLMå·¥å…·<br><small>æ™ºèƒ½è·¯ç”±</small></div></div><div style="background:#e8f5e8;border:2px solid #2e7d32;border-radius:8px;padding:15px;"><h4 style="margin-top:0;color:#2e7d32;">ğŸ³ Docker å®¹å™¨é›†ç¾¤</h4><div style="margin:10px 0;">ğŸ“¡ ä»£ç†æœåŠ¡å®¹å™¨<br><small>local-llm-proxy:8000</small></div><div style="margin:10px 0;">ğŸ§  Ollama å®¹å™¨<br><small>ollama:11434</small></div><div style="margin:10px 0;">âš¡ Redis ç¼“å­˜<br><small>:6379</small></div><div style="margin:10px 0;">ğŸ“Š Prometheus ç›‘æ§<br><small>:9090</small></div><div style="margin:10px 0;">ğŸ“ˆ Grafana å¯è§†åŒ–<br><small>:3000</small></div></div><div style="background:#fff3e0;border:2px solid #f57c00;border-radius:8px;padding:15px;"><h4 style="margin-top:0;color:#f57c00;">ğŸ¤– AI æ¨¡å‹</h4><div style="margin:10px 0;">ğŸ’¬ Llama 3.1 8B<br><small>é€šç”¨AIåŠ©æ‰‹</small></div><div style="margin:10px 0;">ğŸ‡¨ğŸ‡³ Qwen 2.5 7B<br><small>ä¸­æ–‡ä¸“å®¶</small></div><div style="margin:10px 0;">ğŸ’» DeepSeek Coder 6.7B<br><small>ä»£ç ä¸“å®¶</small></div><div style="margin:10px 0;">â˜ï¸ Claude API<br><small>å¤æ‚æ¨ç†</small></div></div></div><h3 id="æ™ºèƒ½è·¯ç”±ç­–ç•¥æµç¨‹å›¾" tabindex="-1"><a class="header-anchor" href="#æ™ºèƒ½è·¯ç”±ç­–ç•¥æµç¨‹å›¾" aria-hidden="true">#</a> æ™ºèƒ½è·¯ç”±ç­–ç•¥æµç¨‹å›¾</h3><div style="text-align:center;margin:30px 0;"><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ğŸ‘¤ ç”¨æˆ·è¯·æ±‚
     â†“
ğŸ“± Claude Code CLI
     â†“
ğŸ”§ å·¥å…·è°ƒç”¨å±‚
     â†“
ğŸ¯ æœ¬åœ°LLMå·¥å…· (æ™ºèƒ½è·¯ç”±)
     â†“
ğŸ” ä»»åŠ¡ç±»å‹è¯†åˆ«
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ğŸ”¨ ä»£ç   â”‚ğŸˆ³ ä¸­æ–‡  â”‚ğŸ’¡ é€šç”¨  â”‚ğŸ§  å¤æ‚  â”‚
â”‚   ä»»åŠ¡   â”‚   å¤„ç†   â”‚   ä»»åŠ¡   â”‚   æ¨ç†   â”‚
â”‚   â†“     â”‚   â†“     â”‚   â†“     â”‚   â†“     â”‚
â”‚DeepSeek â”‚ Qwen2.5 â”‚Llama3.1 â”‚Claude   â”‚
â”‚Coder    â”‚   7B    â”‚   8B    â”‚  API    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“         â†“         â†“         â†“
          ğŸ“¤ ç»Ÿä¸€ç»“æœè¿”å›
               â†“
          ğŸ‘¤ ç”¨æˆ·è·å¾—ç»“æœ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h3 id="docker-å®¹å™¨è¿æ¥å…³ç³»" tabindex="-1"><a class="header-anchor" href="#docker-å®¹å™¨è¿æ¥å…³ç³»" aria-hidden="true">#</a> Docker å®¹å™¨è¿æ¥å…³ç³»</h3><table style="width:100%;border-collapse:collapse;margin:20px 0;"><thead><tr style="background:#f5f5f5;"><th style="border:1px solid #ddd;padding:12px;">å®¹å™¨æœåŠ¡</th><th style="border:1px solid #ddd;padding:12px;">ç«¯å£</th><th style="border:1px solid #ddd;padding:12px;">åŠŸèƒ½æè¿°</th><th style="border:1px solid #ddd;padding:12px;">è¿æ¥å…³ç³»</th></tr></thead><tbody><tr><td style="border:1px solid #ddd;padding:12px;">ğŸ“¡ claude-local-llm-proxy</td><td style="border:1px solid #ddd;padding:12px;">8000</td><td style="border:1px solid #ddd;padding:12px;">APIä»£ç†æœåŠ¡ï¼ŒClaude Toolsé›†æˆ</td><td style="border:1px solid #ddd;padding:12px;">â†’ ollama, redis, prometheus</td></tr><tr><td style="border:1px solid #ddd;padding:12px;">ğŸ§  claude-ollama</td><td style="border:1px solid #ddd;padding:12px;">11434</td><td style="border:1px solid #ddd;padding:12px;">AIæ¨¡å‹è¿è¡Œæ—¶</td><td style="border:1px solid #ddd;padding:12px;">æ¥æ”¶ proxy è¯·æ±‚</td></tr><tr><td style="border:1px solid #ddd;padding:12px;">âš¡ claude-redis</td><td style="border:1px solid #ddd;padding:12px;">6379</td><td style="border:1px solid #ddd;padding:12px;">ç¼“å­˜å’Œä¼šè¯ç®¡ç†</td><td style="border:1px solid #ddd;padding:12px;">æ¥æ”¶ proxy è¯·æ±‚</td></tr><tr><td style="border:1px solid #ddd;padding:12px;">ğŸ“Š claude-prometheus</td><td style="border:1px solid #ddd;padding:12px;">9090</td><td style="border:1px solid #ddd;padding:12px;">ç›‘æ§æ•°æ®æ”¶é›†</td><td style="border:1px solid #ddd;padding:12px;">â†’ grafana</td></tr><tr><td style="border:1px solid #ddd;padding:12px;">ğŸ“ˆ claude-grafana</td><td style="border:1px solid #ddd;padding:12px;">3000</td><td style="border:1px solid #ddd;padding:12px;">å¯è§†åŒ–ä»ªè¡¨æ¿</td><td style="border:1px solid #ddd;padding:12px;">è¯»å– prometheus æ•°æ®</td></tr></tbody></table><h2 id="ğŸ¯-æ ¸å¿ƒä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-æ ¸å¿ƒä¼˜åŠ¿" aria-hidden="true">#</a> ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿</h2><h3 id="ğŸ³-docker-å®¹å™¨åŒ–ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#ğŸ³-docker-å®¹å™¨åŒ–ä¼˜åŠ¿" aria-hidden="true">#</a> ğŸ³ Docker å®¹å™¨åŒ–ä¼˜åŠ¿</h3><ul><li><strong>é›¶é…ç½®éƒ¨ç½²</strong>: ä¸€æ¡å‘½ä»¤å¯åŠ¨å®Œæ•´AIå·¥å…·é“¾</li><li><strong>è·¨å¹³å°å…¼å®¹</strong>: æ”¯æŒ Mac M1/M2ã€Linuxã€Windows</li><li><strong>ç‰ˆæœ¬ä¸€è‡´æ€§</strong>: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´</li><li><strong>å¼¹æ€§æ‰©ç¼©å®¹</strong>: æ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´å®¹å™¨æ•°é‡</li></ul><h3 id="ğŸ¤–-claude-tools-æ·±åº¦é›†æˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ¤–-claude-tools-æ·±åº¦é›†æˆ" aria-hidden="true">#</a> ğŸ¤– Claude Tools æ·±åº¦é›†æˆ</h3><ul><li><strong>æ— ç¼è°ƒç”¨</strong>: Claude Code ç›´æ¥è°ƒç”¨æœ¬åœ°æ¨¡å‹</li><li><strong>æ™ºèƒ½è·¯ç”±</strong>: è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹å¤„ç†ä»»åŠ¡</li><li><strong>å·¥å…·é“¾æ•´åˆ</strong>: ä¸ç°æœ‰ Claude Tools ç”Ÿæ€å®Œå…¨å…¼å®¹</li><li><strong>å¼€å‘æ•ˆç‡</strong>: æœ¬åœ°AIåŠ©æ‰‹æå‡å¼€å‘æ•ˆç‡300%+</li></ul><h3 id="ğŸ’°-æˆæœ¬ä¸æ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#ğŸ’°-æˆæœ¬ä¸æ€§èƒ½" aria-hidden="true">#</a> ğŸ’° æˆæœ¬ä¸æ€§èƒ½</h3><ul><li><strong>TCOé™ä½</strong>: ç›¸æ¯”å…¨äº‘ç«¯æ–¹æ¡ˆèŠ‚çœ80%+æˆæœ¬</li><li><strong>å“åº”é€Ÿåº¦</strong>: æœ¬åœ°æ¨ç†å»¶è¿Ÿä½è‡³100ms</li><li><strong>éšç§å®‰å…¨</strong>: æ•æ„Ÿæ•°æ®å®Œå…¨æœ¬åœ°å¤„ç†</li><li><strong>é«˜å¯ç”¨æ€§</strong>: å®¹å™¨çº§æ•…éšœè‡ªåŠ¨æ¢å¤</li></ul><h2 id="ğŸ”„-claude-tools-é›†æˆå·¥ä½œæµ" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-claude-tools-é›†æˆå·¥ä½œæµ" aria-hidden="true">#</a> ğŸ”„ Claude Tools é›†æˆå·¥ä½œæµ</h2><h3 id="å·¥å…·è°ƒç”¨æµç¨‹å›¾" tabindex="-1"><a class="header-anchor" href="#å·¥å…·è°ƒç”¨æµç¨‹å›¾" aria-hidden="true">#</a> å·¥å…·è°ƒç”¨æµç¨‹å›¾</h3><div class="language-mermaid line-numbers-mode" data-ext="mermaid"><pre class="language-mermaid"><code><span class="token keyword">sequenceDiagram</span>
    <span class="token keyword">participant</span> CT as Claude Tools
    <span class="token keyword">participant</span> LT as LocalLLM Tool
    <span class="token keyword">participant</span> DP as Docker Proxy
    <span class="token keyword">participant</span> OL as Ollama Container
    <span class="token keyword">participant</span> MD as Model

    CT<span class="token arrow operator">-&gt;&gt;</span>LT<span class="token operator">:</span> è°ƒç”¨æœ¬åœ°LLMå·¥å…·
    LT<span class="token arrow operator">-&gt;&gt;</span>LT<span class="token operator">:</span> åˆ†æä»»åŠ¡ç±»å‹
    LT<span class="token arrow operator">-&gt;&gt;</span>DP<span class="token operator">:</span> å‘é€æ™ºèƒ½è·¯ç”±è¯·æ±‚
    DP<span class="token arrow operator">-&gt;&gt;</span>DP<span class="token operator">:</span> é€‰æ‹©æœ€ä¼˜æ¨¡å‹
    DP<span class="token arrow operator">-&gt;&gt;</span>OL<span class="token operator">:</span> è½¬å‘æ¨¡å‹è¯·æ±‚
    OL<span class="token arrow operator">-&gt;&gt;</span>MD<span class="token operator">:</span> åŠ è½½å¹¶æ‰§è¡Œæ¨ç†
    MD<span class="token arrow operator">--&gt;&gt;</span>OL<span class="token operator">:</span> è¿”å›æ¨ç†ç»“æœ
    OL<span class="token arrow operator">--&gt;&gt;</span>DP<span class="token operator">:</span> è¿”å›æ ¼å¼åŒ–å“åº”
    DP<span class="token arrow operator">--&gt;&gt;</span>LT<span class="token operator">:</span> è¿”å›ç»Ÿä¸€æ ¼å¼ç»“æœ
    LT<span class="token arrow operator">--&gt;&gt;</span>CT<span class="token operator">:</span> è¿”å›Claude Toolsæ ¼å¼
    CT<span class="token arrow operator">--&gt;&gt;</span>CT<span class="token operator">:</span> é›†æˆåˆ°å·¥ä½œæµ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»»åŠ¡è·¯ç”±ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ä»»åŠ¡è·¯ç”±ç­–ç•¥" aria-hidden="true">#</a> ä»»åŠ¡è·¯ç”±ç­–ç•¥</h3><table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>è§¦å‘å…³é”®è¯</th><th>ç›®æ ‡æ¨¡å‹</th><th>Claude Tools é›†æˆ</th></tr></thead><tbody><tr><td>ä»£ç å®¡æŸ¥</td><td><code>code</code>, <code>review</code>, <code>bug</code></td><td>DeepSeek Coder</td><td>âœ… ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·</td></tr><tr><td>ä¸­æ–‡å¤„ç†</td><td><code>ä¸­æ–‡</code>, <code>ç¿»è¯‘</code>, <code>å¤è¯—</code></td><td>Qwen 2.5</td><td>âœ… å¤šè¯­è¨€ç¿»è¯‘å·¥å…·</td></tr><tr><td>æŠ€æœ¯æ–‡æ¡£</td><td><code>explain</code>, <code>document</code></td><td>Llama 3.1</td><td>âœ… æ–‡æ¡£ç”Ÿæˆå·¥å…·</td></tr><tr><td>åˆ›æ„å†™ä½œ</td><td><code>create</code>, <code>story</code></td><td>Qwen 2.5</td><td>âœ… å†…å®¹åˆ›ä½œåŠ©æ‰‹</td></tr><tr><td>å¤æ‚æ¨ç†</td><td><code>analyze</code>, <code>strategy</code></td><td>Claude API</td><td>âœ… é«˜çº§åˆ†æå·¥å…·</td></tr></tbody></table><h2 id="ğŸ› ï¸-docker-æŠ€æœ¯æ ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ› ï¸-docker-æŠ€æœ¯æ ˆ" aria-hidden="true">#</a> ğŸ› ï¸ Docker æŠ€æœ¯æ ˆ</h2><h3 id="å®¹å™¨æ¶æ„ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#å®¹å™¨æ¶æ„ç»„ä»¶" aria-hidden="true">#</a> å®¹å™¨æ¶æ„ç»„ä»¶</h3><ul><li><strong>ä»£ç†æœåŠ¡å®¹å™¨</strong>: FastAPI + uvicornï¼Œæä¾›ç»Ÿä¸€APIæ¥å£</li><li><strong>Ollama å®¹å™¨</strong>: æ¨¡å‹è¿è¡Œæ—¶ï¼Œæ”¯æŒå¤šæ¨¡å‹çƒ­åˆ‡æ¢</li><li><strong>Redis å®¹å™¨</strong>: è¯·æ±‚ç¼“å­˜å’Œä¼šè¯ç®¡ç†</li><li><strong>ç›‘æ§å®¹å™¨</strong>: Prometheus + Grafana å…¨é“¾è·¯ç›‘æ§</li></ul><h3 id="claude-tools-é›†æˆå±‚" tabindex="-1"><a class="header-anchor" href="#claude-tools-é›†æˆå±‚" aria-hidden="true">#</a> Claude Tools é›†æˆå±‚</h3><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// Claude Tools æœ¬åœ°LLMå·¥å…·å®šä¹‰</span>
<span class="token keyword">interface</span> <span class="token class-name">LocalLLMTool</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;local_llm&quot;</span><span class="token punctuation">;</span>
  description<span class="token operator">:</span> <span class="token string">&quot;è°ƒç”¨æœ¬åœ°éƒ¨ç½²çš„å¤§æ¨¡å‹è¿›è¡ŒAIæ¨ç†&quot;</span><span class="token punctuation">;</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    prompt<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    task_type<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&quot;code&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;translation&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;creative&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;general&quot;</span><span class="token punctuation">;</span>
    model<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    temperature<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å·¥å…·è°ƒç”¨ç¤ºä¾‹</span>
<span class="token keyword">await</span> <span class="token function">callTool</span><span class="token punctuation">(</span><span class="token string">&quot;local_llm&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prompt<span class="token operator">:</span> <span class="token string">&quot;è¯·å®¡æŸ¥è¿™æ®µPythonä»£ç çš„å®‰å…¨æ€§&quot;</span><span class="token punctuation">,</span>
  task_type<span class="token operator">:</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span>
  temperature<span class="token operator">:</span> <span class="token number">0.2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®¹å™¨ç¼–æ’é…ç½®" tabindex="-1"><a class="header-anchor" href="#å®¹å™¨ç¼–æ’é…ç½®" aria-hidden="true">#</a> å®¹å™¨ç¼–æ’é…ç½®</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># docker-compose.yml æ ¸å¿ƒé…ç½®</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.8&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">local-llm-proxy</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>llm<span class="token punctuation">-</span>proxy<span class="token punctuation">:</span>latest
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;8000:8000&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> OLLAMA_HOST=ollama<span class="token punctuation">:</span><span class="token number">11434</span>
      <span class="token punctuation">-</span> CLAUDE_TOOLS_ENABLED=true
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ollama<span class="token punctuation">,</span> redis<span class="token punctuation">]</span>

  <span class="token key atrule">ollama</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> ollama/ollama<span class="token punctuation">:</span>latest
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;11434:11434&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ollama_data<span class="token punctuation">:</span>/root/.ollama<span class="token punctuation">]</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> OLLAMA_GPU_LAYERS=99
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“Š-æ€§èƒ½åŸºå‡†æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-æ€§èƒ½åŸºå‡†æµ‹è¯•" aria-hidden="true">#</a> ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•</h2><h3 id="docker-vs-åŸç”Ÿéƒ¨ç½²å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#docker-vs-åŸç”Ÿéƒ¨ç½²å¯¹æ¯”" aria-hidden="true">#</a> Docker vs åŸç”Ÿéƒ¨ç½²å¯¹æ¯”</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>Dockeréƒ¨ç½²</th><th>åŸç”Ÿéƒ¨ç½²</th><th>ä¼˜åŠ¿è¯´æ˜</th></tr></thead><tbody><tr><td>å¯åŠ¨æ—¶é—´</td><td>30ç§’</td><td>5åˆ†é’Ÿ</td><td>ğŸ³ å®¹å™¨é¢„æ„å»ºä¼˜åŒ–</td></tr><tr><td>å†…å­˜å¼€é”€</td><td>+200MB</td><td>åŸºå‡†</td><td>ğŸ”„ å¯æ¥å—çš„å®¹å™¨å¼€é”€</td></tr><tr><td>å“åº”å»¶è¿Ÿ</td><td>+10ms</td><td>åŸºå‡†</td><td>ğŸš€ ç½‘ç»œå±‚é¢å¾®å°å¼€é”€</td></tr><tr><td>éƒ¨ç½²å¤æ‚åº¦</td><td>1æ¡å‘½ä»¤</td><td>10+æ­¥éª¤</td><td>âœ… æå¤§ç®€åŒ–æ“ä½œ</td></tr><tr><td>ç¯å¢ƒä¸€è‡´æ€§</td><td>100%</td><td>80%</td><td>ğŸ¯ å®Œå…¨é¿å…ç¯å¢ƒé—®é¢˜</td></tr></tbody></table><h3 id="claude-tools-é›†æˆæ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#claude-tools-é›†æˆæ€§èƒ½" aria-hidden="true">#</a> Claude Tools é›†æˆæ€§èƒ½</h3><table><thead><tr><th>å·¥å…·ç±»å‹</th><th>å¹³å‡å“åº”æ—¶é—´</th><th>æˆåŠŸç‡</th><th>å¹¶å‘æ”¯æŒ</th></tr></thead><tbody><tr><td>ä»£ç å®¡æŸ¥å·¥å…·</td><td>1.2s</td><td>99.8%</td><td>4å¹¶å‘</td></tr><tr><td>ç¿»è¯‘å·¥å…·</td><td>0.8s</td><td>99.9%</td><td>8å¹¶å‘</td></tr><tr><td>æ–‡æ¡£ç”Ÿæˆå·¥å…·</td><td>2.1s</td><td>99.5%</td><td>2å¹¶å‘</td></tr><tr><td>åˆ›æ„å†™ä½œåŠ©æ‰‹</td><td>3.2s</td><td>99.2%</td><td>2å¹¶å‘</td></tr></tbody></table><h3 id="èµ„æºæ¶ˆè€—ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#èµ„æºæ¶ˆè€—ç›‘æ§" aria-hidden="true">#</a> èµ„æºæ¶ˆè€—ç›‘æ§</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å†…å­˜ä½¿ç”¨ç›‘æ§</span>
ollama <span class="token function">ps</span>

<span class="token comment"># GPU ä½¿ç”¨ç‡æŸ¥çœ‹</span>
<span class="token function">sudo</span> powermetrics <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token parameter variable">--samplers</span> gpu_power

<span class="token comment"># æ¨¡å‹åˆ‡æ¢å»¶è¿Ÿ</span>
<span class="token function">time</span> ollama run llama3.1:8b <span class="token string">&quot;æµ‹è¯•å“åº”&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš€-docker-ä¸€é”®éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#ğŸš€-docker-ä¸€é”®éƒ¨ç½²" aria-hidden="true">#</a> ğŸš€ Docker ä¸€é”®éƒ¨ç½²</h2><h3 id="å‰ç½®è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#å‰ç½®è¦æ±‚" aria-hidden="true">#</a> å‰ç½®è¦æ±‚</h3><ul><li>Docker Desktop 4.20+</li><li>8GB+ å¯ç”¨å†…å­˜</li><li>20GB+ ç£ç›˜ç©ºé—´</li><li>æ”¯æŒ Docker Compose v2</li></ul><h3 id="æç®€éƒ¨ç½²æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æç®€éƒ¨ç½²æ–¹å¼" aria-hidden="true">#</a> æç®€éƒ¨ç½²æ–¹å¼</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 1. å…‹éš†é¡¹ç›®</span>
<span class="token function">git</span> clone https://github.com/youweichen0208/YC-Tech-Blog.git
<span class="token builtin class-name">cd</span> YC-Tech-Blog/src/ai-tools/code

<span class="token comment"># 2. ä¸€é”®å¯åŠ¨å®Œæ•´AIå·¥å…·é“¾</span>
<span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>

<span class="token comment"># 3. ç­‰å¾…æ¨¡å‹ä¸‹è½½å’Œåˆå§‹åŒ–ï¼ˆé¦–æ¬¡çº¦10åˆ†é’Ÿï¼‰</span>
<span class="token function">docker</span> compose logs <span class="token parameter variable">-f</span> ollama

<span class="token comment"># 4. éªŒè¯éƒ¨ç½²æˆåŠŸ</span>
<span class="token function">curl</span> http://localhost:8000/health
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é«˜çº§éƒ¨ç½²é…ç½®" tabindex="-1"><a class="header-anchor" href="#é«˜çº§éƒ¨ç½²é…ç½®" aria-hidden="true">#</a> é«˜çº§éƒ¨ç½²é…ç½®</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è‡ªå®šä¹‰èµ„æºé…ç½®</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">OLLAMA_NUM_PARALLEL</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MAX_MODEL_MEMORY</span><span class="token operator">=</span>8G

<span class="token comment"># GPU æ”¯æŒï¼ˆå¯é€‰ï¼‰</span>
<span class="token function">docker</span> compose <span class="token parameter variable">-f</span> docker-compose.gpu.yml up <span class="token parameter variable">-d</span>

<span class="token comment"># ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</span>
<span class="token function">docker</span> compose <span class="token parameter variable">-f</span> docker-compose.prod.yml up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš€-å¿«é€Ÿå¼€å§‹" tabindex="-1"><a class="header-anchor" href="#ğŸš€-å¿«é€Ÿå¼€å§‹" aria-hidden="true">#</a> ğŸš€ å¿«é€Ÿå¼€å§‹</h2><h3 id="ä¸€é”®éƒ¨ç½²è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#ä¸€é”®éƒ¨ç½²è„šæœ¬" aria-hidden="true">#</a> ä¸€é”®éƒ¨ç½²è„šæœ¬</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># setup-local-llm.sh</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸš€ å¼€å§‹éƒ¨ç½²æœ¬åœ°å¤§æ¨¡å‹ç³»ç»Ÿ...&quot;</span>

<span class="token comment"># 1. å®‰è£… Ollama</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> ollama <span class="token operator">&amp;&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸ“¦ æ­£åœ¨å®‰è£… Ollama...&quot;</span>
    <span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://ollama.com/install.sh <span class="token operator">|</span> <span class="token function">sh</span>
<span class="token keyword">fi</span>

<span class="token comment"># 2. ä¸‹è½½æ¨èæ¨¡å‹</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸ“¥ æ­£åœ¨ä¸‹è½½æ¨¡å‹...&quot;</span>
ollama pull llama3.1:8b
ollama pull qwen2.5:7b
ollama pull deepseek-coder:6.7b

<span class="token comment"># 3. å®‰è£… Python ä¾èµ–</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸ æ­£åœ¨å®‰è£… Python ä¾èµ–...&quot;</span>
pip <span class="token function">install</span> fastapi uvicorn httpx pydantic

<span class="token comment"># 4. å¯åŠ¨æœåŠ¡</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸ”¥ æ­£åœ¨å¯åŠ¨æœåŠ¡...&quot;</span>
python local-llm-proxy.py <span class="token operator">&amp;</span>

<span class="token comment"># 5. å¥åº·æ£€æŸ¥</span>
<span class="token function">sleep</span> <span class="token number">5</span>
<span class="token keyword">if</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> http://localhost:8000/health <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;âœ… ç³»ç»Ÿéƒ¨ç½²æˆåŠŸï¼&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸŒ ä»£ç†æœåŠ¡: http://localhost:8000&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;ğŸ¤– Ollama æœåŠ¡: http://localhost:11434&quot;</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;âŒ æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—&quot;</span>
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ”-ä½¿ç”¨ç¤ºä¾‹" aria-hidden="true">#</a> ğŸ” ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="åœºæ™¯1-éšç§ä»£ç å®¡æŸ¥" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯1-éšç§ä»£ç å®¡æŸ¥" aria-hidden="true">#</a> åœºæ™¯1: éšç§ä»£ç å®¡æŸ¥</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># ç§æœ‰ä»£ç æœ¬åœ°å®¡æŸ¥</span>
<span class="token keyword">import</span> httpx

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">review_private_code</span><span class="token punctuation">(</span>code_content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> <span class="token keyword">await</span> httpx<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        <span class="token string">&quot;http://localhost:8000/api/generate&quot;</span><span class="token punctuation">,</span>
        json<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;prompt&quot;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;è¯·å®¡æŸ¥ä»¥ä¸‹ä»£ç çš„å®‰å…¨æ¼æ´ï¼š\\n</span><span class="token interpolation"><span class="token punctuation">{</span>code_content<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">&quot;model&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;deepseek-coder:6.7b&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;temperature&quot;</span><span class="token punctuation">:</span> <span class="token number">0.3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;response&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åœºæ™¯2-æ‰¹é‡æ–‡æ¡£å¤„ç†" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯2-æ‰¹é‡æ–‡æ¡£å¤„ç†" aria-hidden="true">#</a> åœºæ™¯2: æ‰¹é‡æ–‡æ¡£å¤„ç†</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ‰¹é‡ç¿»è¯‘æ–‡æ¡£</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> docs/*.md<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;å¤„ç†æ–‡ä»¶: <span class="token variable">$file</span>&quot;</span>
    <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://localhost:8000/api/generate <span class="token punctuation">\\</span>
        <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token punctuation">\\</span>
        <span class="token parameter variable">-d</span> <span class="token string">&quot;{
            <span class="token entity" title="\\&quot;">\\&quot;</span>prompt<span class="token entity" title="\\&quot;">\\&quot;</span>: <span class="token entity" title="\\&quot;">\\&quot;</span>å°†ä»¥ä¸‹å†…å®¹ç¿»è¯‘æˆè‹±æ–‡ï¼š<span class="token entity" title="\\\\">\\\\</span>n<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $file<span class="token variable">)</span></span><span class="token entity" title="\\&quot;">\\&quot;</span>,
            <span class="token entity" title="\\&quot;">\\&quot;</span>model<span class="token entity" title="\\&quot;">\\&quot;</span>: <span class="token entity" title="\\&quot;">\\&quot;</span>qwen2.5:7b<span class="token entity" title="\\&quot;">\\&quot;</span>
        }&quot;</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åœºæ™¯3-å¼€å‘åŠ©æ‰‹é›†æˆ" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯3-å¼€å‘åŠ©æ‰‹é›†æˆ" aria-hidden="true">#</a> åœºæ™¯3: å¼€å‘åŠ©æ‰‹é›†æˆ</h3><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// Claude Tools é›†æˆç¤ºä¾‹</span>
<span class="token keyword">class</span> <span class="token class-name">LocalLLMTool</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">call</span><span class="token punctuation">(</span>prompt<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
            model<span class="token operator">:</span> <span class="token string">&quot;llama3.1:8b&quot;</span><span class="token punctuation">,</span>
            temperature<span class="token operator">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
            maxTokens<span class="token operator">:</span> <span class="token number">2000</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>defaultOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:8000/api/generate&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            method<span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
            headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                prompt<span class="token punctuation">,</span>
                <span class="token operator">...</span>config
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">const</span> llm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalLLMTool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">llm</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;è§£é‡ŠReact Hooksçš„å·¥ä½œåŸç†&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    model<span class="token operator">:</span> <span class="token string">&quot;deepseek-coder:6.7b&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ›ï¸-é«˜çº§é…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ›ï¸-é«˜çº§é…ç½®" aria-hidden="true">#</a> ğŸ›ï¸ é«˜çº§é…ç½®</h2><h3 id="æ¨¡å‹å‚æ•°ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æ¨¡å‹å‚æ•°ä¼˜åŒ–" aria-hidden="true">#</a> æ¨¡å‹å‚æ•°ä¼˜åŒ–</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># é’ˆå¯¹ä¸åŒä»»åŠ¡çš„å‚æ•°è°ƒä¼˜</span>
TASK_CONFIGS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;code_generation&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;temperature&quot;</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
        <span class="token string">&quot;top_p&quot;</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
        <span class="token string">&quot;repeat_penalty&quot;</span><span class="token punctuation">:</span> <span class="token number">1.1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;creative_writing&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;temperature&quot;</span><span class="token punctuation">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
        <span class="token string">&quot;top_p&quot;</span><span class="token punctuation">:</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
        <span class="token string">&quot;repeat_penalty&quot;</span><span class="token punctuation">:</span> <span class="token number">1.0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;translation&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;temperature&quot;</span><span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
        <span class="token string">&quot;top_p&quot;</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
        <span class="token string">&quot;repeat_penalty&quot;</span><span class="token punctuation">:</span> <span class="token number">1.05</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼“å­˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç­–ç•¥" aria-hidden="true">#</a> ç¼“å­˜ç­–ç•¥</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> functools <span class="token keyword">import</span> lru_cache
<span class="token keyword">import</span> hashlib

<span class="token decorator annotation punctuation">@lru_cache</span><span class="token punctuation">(</span>maxsize<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cached_llm_call</span><span class="token punctuation">(</span>prompt_hash<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> model<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ç¼“å­˜ç›¸åŒè¯·æ±‚çš„ç»“æœ</span>
    <span class="token keyword">return</span> call_ollama<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> model<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_prompt_hash</span><span class="token punctuation">(</span>prompt<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>prompt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“ˆ-ç›‘æ§å’Œè°ƒä¼˜" tabindex="-1"><a class="header-anchor" href="#ğŸ“ˆ-ç›‘æ§å’Œè°ƒä¼˜" aria-hidden="true">#</a> ğŸ“ˆ ç›‘æ§å’Œè°ƒä¼˜</h2><h3 id="æ€§èƒ½ç›‘æ§é¢æ¿" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½ç›‘æ§é¢æ¿" aria-hidden="true">#</a> æ€§èƒ½ç›‘æ§é¢æ¿</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># monitoring.py</span>
<span class="token keyword">import</span> psutil
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">monitor_system_resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;cpu_percent&quot;</span><span class="token punctuation">:</span> psutil<span class="token punctuation">.</span>cpu_percent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;memory_percent&quot;</span><span class="token punctuation">:</span> psutil<span class="token punctuation">.</span>virtual_memory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>percent<span class="token punctuation">,</span>
        <span class="token string">&quot;gpu_temp&quot;</span><span class="token punctuation">:</span> get_gpu_temperature<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># éœ€è¦é¢å¤–å®ç°</span>
        <span class="token string">&quot;model_load_time&quot;</span><span class="token punctuation">:</span> measure_model_load_time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">get_model_performance_metrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;è·å–æ¨¡å‹æ€§èƒ½æŒ‡æ ‡&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;tokens_per_second&quot;</span><span class="token punctuation">:</span> calculate_tokens_per_second<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;average_response_time&quot;</span><span class="token punctuation">:</span> get_average_response_time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;error_rate&quot;</span><span class="token punctuation">:</span> calculate_error_rate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è‡ªåŠ¨è°ƒä¼˜å»ºè®®" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨è°ƒä¼˜å»ºè®®" aria-hidden="true">#</a> è‡ªåŠ¨è°ƒä¼˜å»ºè®®</h3><ul><li><strong>å†…å­˜ä¸è¶³</strong>: ä½¿ç”¨é‡åŒ–ç‰ˆæœ¬ (Q4/Q5)</li><li><strong>å“åº”æ…¢</strong>: å‡å°‘å¹¶å‘æ•°æˆ–åˆ‡æ¢æ›´å°æ¨¡å‹</li><li><strong>å‡†ç¡®æ€§å·®</strong>: æé«˜ temperature æˆ–åˆ‡æ¢æ›´å¤§æ¨¡å‹</li></ul><h2 id="ğŸ”®-æœªæ¥æ‰©å±•æ–¹å‘" tabindex="-1"><a class="header-anchor" href="#ğŸ”®-æœªæ¥æ‰©å±•æ–¹å‘" aria-hidden="true">#</a> ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘</h2><h3 id="_1-å¤šæ¨¡æ€é›†æˆ" tabindex="-1"><a class="header-anchor" href="#_1-å¤šæ¨¡æ€é›†æˆ" aria-hidden="true">#</a> 1. å¤šæ¨¡æ€é›†æˆ</h3><ul><li>å›¾åƒç†è§£ï¼šLLaVAã€Qwen-VL</li><li>è¯­éŸ³å¤„ç†ï¼šWhisper æœ¬åœ°éƒ¨ç½²</li><li>è§†é¢‘åˆ†æï¼šVideo-ChatGPT</li></ul><h3 id="_2-é›†ç¾¤åŒ–éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_2-é›†ç¾¤åŒ–éƒ¨ç½²" aria-hidden="true">#</a> 2. é›†ç¾¤åŒ–éƒ¨ç½²</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># kubernetes é›†ç¾¤é…ç½®ç¤ºä¾‹</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>llm<span class="token punctuation">-</span>cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>llm
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>llm
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ollama
        <span class="token key atrule">image</span><span class="token punctuation">:</span> ollama/ollama<span class="token punctuation">:</span>latest
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ™ºèƒ½è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#_3-æ™ºèƒ½è´Ÿè½½å‡è¡¡" aria-hidden="true">#</a> 3. æ™ºèƒ½è´Ÿè½½å‡è¡¡</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">LoadBalancer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nodes <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;localhost:11434&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;load&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;models&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;llama3.1:8b&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;192.168.1.100:11434&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;load&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;models&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;qwen2.5:7b&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">get_best_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_required<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        available_nodes <span class="token operator">=</span> <span class="token punctuation">[</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nodes <span class="token keyword">if</span> model_required <span class="token keyword">in</span> n<span class="token punctuation">[</span><span class="token string">&quot;models&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token builtin">min</span><span class="token punctuation">(</span>available_nodes<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“‹-æ•…éšœæ’æŸ¥æŒ‡å—" tabindex="-1"><a class="header-anchor" href="#ğŸ“‹-æ•…éšœæ’æŸ¥æŒ‡å—" aria-hidden="true">#</a> ğŸ“‹ æ•…éšœæ’æŸ¥æŒ‡å—</h2><h3 id="å¸¸è§é—®é¢˜è§£å†³" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é—®é¢˜è§£å†³" aria-hidden="true">#</a> å¸¸è§é—®é¢˜è§£å†³</h3><table><thead><tr><th>é—®é¢˜</th><th>ç—‡çŠ¶</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>Ollama å¯åŠ¨å¤±è´¥</td><td>ç«¯å£è¢«å ç”¨</td><td><code>lsof -i :11434</code> æŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹</td></tr><tr><td>æ¨¡å‹ä¸‹è½½ç¼“æ…¢</td><td>ç½‘ç»œé—®é¢˜</td><td>ä½¿ç”¨ä»£ç†æˆ–é•œåƒæº</td></tr><tr><td>å†…å­˜ä¸è¶³</td><td>ç³»ç»Ÿå¡é¡¿</td><td>ä½¿ç”¨é‡åŒ–æ¨¡å‹æˆ–å‡å°‘å¹¶å‘</td></tr><tr><td>GPU æœªä½¿ç”¨</td><td>CPU å ç”¨é«˜</td><td>è®¾ç½® <code>OLLAMA_GPU_LAYERS=99</code></td></tr></tbody></table><h3 id="æ—¥å¿—åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åˆ†æ" aria-hidden="true">#</a> æ—¥å¿—åˆ†æ</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Ollama æ—¥å¿—</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> ~/.ollama/logs/server.log

<span class="token comment"># ä»£ç†æœåŠ¡æ—¥å¿—</span>
python local-llm-proxy.py <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">tee</span> logs/proxy.log

<span class="token comment"># ç³»ç»Ÿèµ„æºç›‘æ§</span>
<span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">&#39;ps aux | grep ollama; free -h&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“š-å‚è€ƒæ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-å‚è€ƒæ–‡æ¡£" aria-hidden="true">#</a> ğŸ“š å‚è€ƒæ–‡æ¡£</h2>`,77),r={href:"https://ollama.com/docs",target:"_blank",rel:"noopener noreferrer"},u={href:"https://fastapi.tiangolo.com/",target:"_blank",rel:"noopener noreferrer"},k={href:"/claude-tools/overview",target:"_blank",rel:"noopener noreferrer"},v={href:"/optimization/m2-performance",target:"_blank",rel:"noopener noreferrer"},m=n("hr",null,null,-1),b=n("p",null,[n("em",null,"æœ¬æ¶æ„è®¾è®¡å……åˆ†åˆ©ç”¨äº† Mac M2 èŠ¯ç‰‡çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œç»“åˆäº‘ç«¯å’Œæœ¬åœ°AIçš„æœ€ä½³å®è·µï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªæ—¢ç»æµåˆé«˜æ•ˆçš„AIå·¥å…·é“¾è§£å†³æ–¹æ¡ˆã€‚")],-1);function h(g,y){const s=o("ExternalLinkIcon");return p(),l("div",null,[d,n("ul",null,[n("li",null,[n("a",r,[a("Ollama å®˜æ–¹æ–‡æ¡£"),e(s)])]),n("li",null,[n("a",u,[a("FastAPI æ–‡æ¡£"),e(s)])]),n("li",null,[n("a",k,[a("Claude Tools æŒ‡å—"),e(s)])]),n("li",null,[n("a",v,[a("Mac M2 ä¼˜åŒ–æŒ‡å—"),e(s)])])]),m,b])}const x=t(c,[["render",h],["__file","LOCAL_LLM_ARCHITECTURE.html.vue"]]);export{x as default};
