import{_ as n,o as s,c as a,e}from"./app-5PQHYU9T.js";const t={},o=e(`<h1 id="asynchronous-programming-in-c" tabindex="-1"><a class="header-anchor" href="#asynchronous-programming-in-c" aria-hidden="true">#</a> Asynchronous programming in C#</h1><h2 id="what-is-asynchronous-programming-in-c" tabindex="-1"><a class="header-anchor" href="#what-is-asynchronous-programming-in-c" aria-hidden="true">#</a> What is asynchronous programming in C#</h2><p>Asychronous programming in C# allows us to execute tasks concurrently without blocking the main thread of execution. It&#39;s particularly useful for I/O-bound operations such as reading from or writing to a file, making network requests, or querying a database, where the program would otherwise spend most of its time waiting for the operation to complete.</p><p>In synchronous programming, when we call a method that performs a time-consuming operation, the program waits for that operation to finish before continuing to execute further code. This can lead to inefficiencies, especially in applications that need to handle multiple concurrent tasks.</p><ol><li><p><strong>Asychronous Methods</strong>: We declare a method with the <code>async</code> keyword. This indicates that the method contains asynchronous operations and can be awaited.</p></li><li><p><strong>Awaitable Operations</strong>: Inside an async method, we can use the <code>await</code> keyword before an operation that returns a <code>Task</code> or <code>Task&lt;TResult&gt;</code>. The await keyword pauses the execution of the method until the awaited task completes. During this time, the thread is released and can be used for other tasks.</p></li><li><p><strong>Non-blocking Execution</strong>: While the awaited operation is in progress, the calling thread is free to perform other tasks. When the awaited operation completes, the method resumes execution from where it was paused.</p></li></ol><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">FetchDataAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Async operation completed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">FetchDataAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.example.com/data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Received data: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example, the <code>GetStringAsync</code> method of the <code>HttpClient</code> class returns a <code>Task&lt;string&gt;</code>, indicating that it can be awaited asynchronously. When the <code>FetchDayaAsync</code> method calls <code>GetStringAsync</code>, it awaits the completion of the HTTP request without blocking the main thread. Once the data is received, the method contines executing, and the result is printed to the console.</p><h2 id="overview-of-the-asynchronous-model" tabindex="-1"><a class="header-anchor" href="#overview-of-the-asynchronous-model" aria-hidden="true">#</a> Overview of the asynchronous model</h2><p>The core of async programming is the <code>Task</code> and <code>Task&lt;T&gt;</code> objects, which model asynchronous operations. The model is fairly simple in most cases:</p><ul><li><p>For I/O-bound code, we await an operation that returns a <code>Task</code> or <code>Task&lt;T&gt;</code> inside of an <code>async</code> method.</p></li><li><p>For CPU-bound code, we await an operation that is started on a background thread with the <code>Task.Run</code> method.</p></li></ul><h3 id="i-o-bound-example-download-data-from-a-web-service" tabindex="-1"><a class="header-anchor" href="#i-o-bound-example-download-data-from-a-web-service" aria-hidden="true">#</a> I/O-bound example: Download data from a web service</h3><p>We may need to downlaod some data from a web service when a button is pressed but don&#39;t want to block the UI thread. It can be accomplished like this:</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>s_downloadButton<span class="token punctuation">.</span>Clicked <span class="token operator">+=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>o<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// This line will yield control to the UI as the request</span>
    <span class="token comment">// from the web service is happening.</span>
    <span class="token comment">//</span>
    <span class="token comment">// The UI thread is now free to perform other work.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> stringData <span class="token operator">=</span> <span class="token keyword">await</span> s_httpClient<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span>URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">DoSomethingWithData</span><span class="token punctuation">(</span>stringData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cpu-bound-example-perform-a-calculation-for-a-game" tabindex="-1"><a class="header-anchor" href="#cpu-bound-example-perform-a-calculation-for-a-game" aria-hidden="true">#</a> CPU-bound example: Perform a calculation for a game</h3><p>Say we&#39;re writing a mobile game when pressing a button can inflict damage on many enemies on the screen. Performing the damage calculation can be expensive, and doing it on the UI thread would make the game appear to pause as the calculation is performed.</p><p>The best way to handle this is to start a background thread, which does the work using <code>Task.Run</code>, and await its result using <code>await</code>. This allows the UI to feel smooth as the work is being done.</p><h3 id="recognize-cpu-bound-and-i-o-bound-work" tabindex="-1"><a class="header-anchor" href="#recognize-cpu-bound-and-i-o-bound-work" aria-hidden="true">#</a> Recognize CPU-bound and I/O-bound work</h3><p>Here are two questions we should ask before we write any asynchronous code:</p><ol><li>Will our code be &quot;waiting&quot; for something, such as data from a database? If the answer is &quot;yes&quot;, then our work is <strong>I/O-bound</strong>.</li><li>Will our code be performing an expensive computation? If the answer is &quot;yes&quot;, then our work is <strong>CPU-bound</strong>.</li></ol><p>If the work we have is <strong>I/O-bound</strong>, use <code>async</code> and <code>await</code> without <code>Task.Run</code>. we should not use the Task Parallel Library.</p><p>If the work we have is <strong>CPU-bound</strong> and we care about responsiveness, use <code>async</code> and <code>await</code>, but spawn off the work on another thread with <code>Task.Run</code>.</p><h2 id="async-return-types-c" tabindex="-1"><a class="header-anchor" href="#async-return-types-c" aria-hidden="true">#</a> Async return types (C#)</h2><h3 id="task-return-type" tabindex="-1"><a class="header-anchor" href="#task-return-type" aria-hidden="true">#</a> Task return type:</h3><p>If we use a Task return type for an async method, a calling method can use an <code>await</code> operator to suspend the caller&#39;s completion until the called async method has finished.</p><p>In the following example, the <code>waitAndApologizeAsync</code> method doesn&#39;t contain a <code>return</code> statement, so the method returns a <code>Task</code> object. Returning a <code>Task</code> enables <code>WaitAndApologizeAsync</code> to be awaited. The Task type doesn&#39;t include a <code>Result</code> property because it has no return value.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">DisplayCurrentInfoAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">WaitAndApologizeAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Today is </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token format-string"><span class="token punctuation">:</span>D</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;The current time is </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span>TimeOfDay</span><span class="token format-string"><span class="token punctuation">:</span>t</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;The current temperature is 76 degrees.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">WaitAndApologizeAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Sorry for the delay...\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Example output:</span>
<span class="token comment">//    Sorry for the delay...</span>
<span class="token comment">//</span>
<span class="token comment">// Today is Monday, August 17, 2020</span>
<span class="token comment">// The current time is 12:59:24.2183304</span>
<span class="token comment">// The current temperature is 76 degrees.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>WaitAndApologizeAsync</code> is awaited by using an await statement instead of an await expression, similar to the calling statement for a synchronous void-returning method. The application of an await operator in this case doesn&#39;t produce a value. When the right operand of an <code>await</code> is a <code>Task&lt;TResult&gt;</code>, the <code>await</code> expression produces a result of <code>T</code>. When the right operand of an <code>await</code> is a Task, the <code>await</code> and its operand are a statement.</p><h3 id="task-tresult-return-type" tabindex="-1"><a class="header-anchor" href="#task-tresult-return-type" aria-hidden="true">#</a> <code>Task&lt;TResult&gt;</code> return type</h3><p>The <code>Task&lt;TResult&gt;</code> return type is used for an async method that contains a return statement in which the operand is <code>TResult</code>.</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">ShowTodaysInfoAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span>
        <span class="token interpolation-string"><span class="token string">$&quot;Today is </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Today</span><span class="token format-string"><span class="token punctuation">:</span>D</span><span class="token punctuation">}</span></span><span class="token string">\\n&quot;</span></span> <span class="token operator">+</span>
        <span class="token string">&quot;Today&#39;s hours of leisure: &quot;</span> <span class="token operator">+</span>
        <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">await</span> <span class="token function">GetLeisureHoursAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetLeisureHoursAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DayOfWeek</span> today <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span>DayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">int</span></span> leisureHours <span class="token operator">=</span>
        today <span class="token keyword">is</span> <span class="token class-name">DayOfWeek<span class="token punctuation">.</span>Saturday</span> <span class="token operator">||</span> today <span class="token keyword">is</span> <span class="token class-name">DayOfWeek<span class="token punctuation">.</span>Sunday
        <span class="token punctuation">?</span></span> <span class="token number">16</span> <span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> leisureHours<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Example output:</span>
<span class="token comment">//    Today is Wednesday, May 24, 2017</span>
<span class="token comment">//    Today&#39;s hours of leisure: 5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the example above, the <code>GetLeisureHoursAsync</code> method contains a <code>return</code> statement that returns an integer. The method declaration must specify a return type of <code>Task&lt;int&gt;</code>.</p><h3 id="void-return-type" tabindex="-1"><a class="header-anchor" href="#void-return-type" aria-hidden="true">#</a> Void return type</h3><p>We can use the <code>void</code> return type in asynchronous event handlers, which require a <code>void</code> return type. For methods other than event handlers that don&#39;t return a value, we should return a Task instead, because an async method that returns <code>void</code> can&#39;t be awaited. Any call of such a method must continue to completion without waiting for the called async method to finish. The caller must be independent of any values or exceptions that the async method generates.</p><h2 id="what-is-the-difference-between-multi-threading-and-asynchronous-programming" tabindex="-1"><a class="header-anchor" href="#what-is-the-difference-between-multi-threading-and-asynchronous-programming" aria-hidden="true">#</a> What is the difference between multi-threading and asynchronous programming?</h2><p>In multithreaded programming, concurrency is achieved by executing multiple threads simultaneously, each performing a separate task. These threads can run concurrently on multiple CPU cores. In contrast, async/await is a cooperative concurrency model where tasks yield control back to the calling thread when they are waiting for asynchronous operations to complete. This allows the same thread to be used for multiple tasks, reducing the overhead of creating and managing multiple threads.</p><h2 id="explain-the-scenarios-where-would-we-use-task-whenany-and-task-whenall" tabindex="-1"><a class="header-anchor" href="#explain-the-scenarios-where-would-we-use-task-whenany-and-task-whenall" aria-hidden="true">#</a> Explain the scenarios where would we use <code>Task.WhenAny()</code> and <code>Task.WhenAll()</code>?</h2><h3 id="task-whenany" tabindex="-1"><a class="header-anchor" href="#task-whenany" aria-hidden="true">#</a> <code>Task.WhenAny()</code>:</h3><p><code>Task.WhenAny()</code> returns a task that completes when any of the input tasks have completed, whether successfully, with an error, or due to cancellation. It allows us to perform an action as soon as any one of the tasks completes. This can be useful in scenarios such as:</p><ol><li><p><strong>Parallel Web Requests</strong>: When making multiple HTTP requests to different endpoints concurrently, we might want to process the response of the first successful request or handle the case where one of the requests fails or takes too long.</p></li><li><p><strong>Load Balancing</strong>: In a distributed system, we might have multiple services performing the same task. Using <code>Task.WhenAny()</code>, we can send a request to the first service that becomes available and ignore the others.</p></li></ol><h3 id="task-whenall" tabindex="-1"><a class="header-anchor" href="#task-whenall" aria-hidden="true">#</a> <code>Task.WhenAll()</code>:</h3><p><code>Task.WhenAll()</code> returns a task that completes when all of the input tasks have completed, either successfully or with an error. It allows us to perform an action once all of the tasks have finished.</p><ol><li><strong>Aggregating Results:</strong> When we need to combine the results of multiple asynchronous operations before proceeding, such as fetching data from multiple resources and merging the results.</li><li><strong>Parallel Processing</strong>: When we have a set of independent tasks that can be executed concurrently and we want ot wait for all of them to complete before continuing.</li></ol>`,42),c=[o];function i(p,l){return s(),a("div",null,c)}const u=n(t,[["render",i],["__file","asynchronous.html.vue"]]);export{u as default};
