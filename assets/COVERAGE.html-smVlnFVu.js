import{_ as a,o as n,c as s,e as t}from"./app-6xODO_ZE.js";const e={},l=t(`<h1 id="代码覆盖率配置指南" tabindex="-1"><a class="header-anchor" href="#代码覆盖率配置指南" aria-hidden="true">#</a> 代码覆盖率配置指南</h1><h2 id="覆盖率服务对比" tabindex="-1"><a class="header-anchor" href="#覆盖率服务对比" aria-hidden="true">#</a> 覆盖率服务对比</h2><h3 id="_1-codecov-推荐-✅" tabindex="-1"><a class="header-anchor" href="#_1-codecov-推荐-✅" aria-hidden="true">#</a> 1. Codecov（推荐）✅</h3><ul><li><strong>优点</strong>: <ul><li>免费支持公开/私有仓库</li><li>GitHub集成完美</li><li>可视化最好</li><li>支持PR评论</li><li>覆盖率徽章</li></ul></li><li><strong>缺点</strong>: 需要注册账号</li><li><strong>官网</strong>: https://codecov.io</li></ul><h3 id="_2-coveralls" tabindex="-1"><a class="header-anchor" href="#_2-coveralls" aria-hidden="true">#</a> 2. Coveralls</h3><ul><li><strong>优点</strong>: 界面简洁，易用</li><li><strong>缺点</strong>: 私有仓库收费</li><li><strong>官网</strong>: https://coveralls.io</li></ul><h3 id="_3-sonarcloud" tabindex="-1"><a class="header-anchor" href="#_3-sonarcloud" aria-hidden="true">#</a> 3. SonarCloud</h3><ul><li><strong>优点</strong>: <ul><li>代码质量+覆盖率</li><li>技术债分析</li><li>安全漏洞扫描</li></ul></li><li><strong>缺点</strong>: 配置复杂</li><li><strong>官网</strong>: https://sonarcloud.io</li></ul><h2 id="快速开始" tabindex="-1"><a class="header-anchor" href="#快速开始" aria-hidden="true">#</a> 快速开始</h2><h3 id="步骤1-注册codecov" tabindex="-1"><a class="header-anchor" href="#步骤1-注册codecov" aria-hidden="true">#</a> 步骤1: 注册Codecov</h3><ol><li>访问 https://codecov.io</li><li>使用GitHub账号登录</li><li>授权访问你的仓库</li><li>获取 <code>CODECOV_TOKEN</code></li></ol><h3 id="步骤2-配置github-secrets" tabindex="-1"><a class="header-anchor" href="#步骤2-配置github-secrets" aria-hidden="true">#</a> 步骤2: 配置GitHub Secrets</h3><ol><li>进入仓库 Settings → Secrets and variables → Actions</li><li>点击 &quot;New repository secret&quot;</li><li>添加: <ul><li>Name: <code>CODECOV_TOKEN</code></li><li>Value: 从Codecov获取的token</li></ul></li></ol><h3 id="步骤3-推送代码" tabindex="-1"><a class="header-anchor" href="#步骤3-推送代码" aria-hidden="true">#</a> 步骤3: 推送代码</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Add coverage reporting&quot;</span>
<span class="token function">git</span> push
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GitHub Actions会自动运行，并上传覆盖率到Codecov。</p><h2 id="在readme中添加徽章" tabindex="-1"><a class="header-anchor" href="#在readme中添加徽章" aria-hidden="true">#</a> 在README中添加徽章</h2><h3 id="java覆盖率徽章" tabindex="-1"><a class="header-anchor" href="#java覆盖率徽章" aria-hidden="true">#</a> Java覆盖率徽章</h3><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code><span class="token url">[<span class="token content">![codecov</span>](<span class="token url">https://codecov.io/gh/YOUR_USERNAME/quant-trading-platform/branch/main/graph/badge.svg?flag=unittests</span>)</span>](https://codecov.io/gh/YOUR_USERNAME/quant-trading-platform)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="前端覆盖率徽章" tabindex="-1"><a class="header-anchor" href="#前端覆盖率徽章" aria-hidden="true">#</a> 前端覆盖率徽章</h3><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code><span class="token url">[<span class="token content">![codecov</span>](<span class="token url">https://codecov.io/gh/YOUR_USERNAME/quant-trading-platform/branch/main/graph/badge.svg?flag=frontend</span>)</span>](https://codecov.io/gh/YOUR_USERNAME/quant-trading-platform)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ci状态徽章" tabindex="-1"><a class="header-anchor" href="#ci状态徽章" aria-hidden="true">#</a> CI状态徽章</h3><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code><span class="token url">[<span class="token content">![CI</span>](<span class="token url">https://github.com/YOUR_USERNAME/quant-trading-platform/actions/workflows/ci.yml/badge.svg</span>)</span>](https://github.com/YOUR_USERNAME/quant-trading-platform/actions/workflows/ci.yml)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="本地生成覆盖率报告" tabindex="-1"><a class="header-anchor" href="#本地生成覆盖率报告" aria-hidden="true">#</a> 本地生成覆盖率报告</h2><h3 id="java-jacoco" tabindex="-1"><a class="header-anchor" href="#java-jacoco" aria-hidden="true">#</a> Java (JaCoCo)</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> user-service
mvn clean <span class="token builtin class-name">test</span> jacoco:report

<span class="token comment"># 查看报告</span>
<span class="token function">open</span> target/site/jacoco/index.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="前端-vitest-jest" tabindex="-1"><a class="header-anchor" href="#前端-vitest-jest" aria-hidden="true">#</a> 前端 (Vitest/Jest)</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> web-frontend
<span class="token function">npm</span> run test:coverage

<span class="token comment"># 查看报告</span>
<span class="token function">open</span> coverage/index.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="覆盖率配置说明" tabindex="-1"><a class="header-anchor" href="#覆盖率配置说明" aria-hidden="true">#</a> 覆盖率配置说明</h2><h3 id="java-pom-xml中的配置" tabindex="-1"><a class="header-anchor" href="#java-pom-xml中的配置" aria-hidden="true">#</a> Java (pom.xml中的配置)</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jacoco<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jacoco-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.8.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 检查覆盖率阈值 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>check<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>check<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rules</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>element</span><span class="token punctuation">&gt;</span></span>PACKAGE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>element</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>limits</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>limit</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>counter</span><span class="token punctuation">&gt;</span></span>LINE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>counter</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>COVEREDRATIO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>minimum</span><span class="token punctuation">&gt;</span></span>0.60<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>minimum</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 60%最低覆盖率 --&gt;</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>limit</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>limits</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rules</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>覆盖率指标说明:</strong></p><ul><li><code>LINE</code>: 行覆盖率（推荐）</li><li><code>BRANCH</code>: 分支覆盖率（更严格）</li><li><code>INSTRUCTION</code>: 字节码指令覆盖率</li><li><code>CLASS</code>: 类覆盖率</li><li><code>METHOD</code>: 方法覆盖率</li></ul><p><strong>推荐阈值:</strong></p><ul><li>新项目: 60-70%</li><li>成熟项目: 80%+</li><li>核心模块: 90%+</li></ul><h2 id="pr中查看覆盖率" tabindex="-1"><a class="header-anchor" href="#pr中查看覆盖率" aria-hidden="true">#</a> PR中查看覆盖率</h2><p>配置完成后，每个Pull Request都会显示:</p><ul><li>✅ 覆盖率变化</li><li>📊 新增代码覆盖率</li><li>💬 Codecov机器人评论</li></ul><h2 id="排除文件" tabindex="-1"><a class="header-anchor" href="#排除文件" aria-hidden="true">#</a> 排除文件</h2><h3 id="java-排除不需要测试的类" tabindex="-1"><a class="header-anchor" href="#java-排除不需要测试的类" aria-hidden="true">#</a> Java - 排除不需要测试的类</h3><p>在JaCoCo配置中添加:</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/config/**<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/dto/**<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/entity/**<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/*Application.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="前端-排除文件-vitest-config-ts" tabindex="-1"><a class="header-anchor" href="#前端-排除文件-vitest-config-ts" aria-hidden="true">#</a> 前端 - 排除文件 (vitest.config.ts)</h3><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token punctuation">{</span>
    coverage<span class="token operator">:</span> <span class="token punctuation">{</span>
      exclude<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;src/**/*.d.ts&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;src/**/*.config.ts&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;src/main.ts&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="其他ci平台" tabindex="-1"><a class="header-anchor" href="#其他ci平台" aria-hidden="true">#</a> 其他CI平台</h2><h3 id="gitlab-ci" tabindex="-1"><a class="header-anchor" href="#gitlab-ci" aria-hidden="true">#</a> GitLab CI</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">test</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> mvn test jacoco<span class="token punctuation">:</span>report
    <span class="token punctuation">-</span> bash &lt;(curl <span class="token punctuation">-</span>s https<span class="token punctuation">:</span>//codecov.io/bash)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="circleci" tabindex="-1"><a class="header-anchor" href="#circleci" aria-hidden="true">#</a> CircleCI</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload coverage
    <span class="token key atrule">command</span><span class="token punctuation">:</span> bash &lt;(curl <span class="token punctuation">-</span>s https<span class="token punctuation">:</span>//codecov.io/bash)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题" aria-hidden="true">#</a> 常见问题</h2><h3 id="q-覆盖率上传失败" tabindex="-1"><a class="header-anchor" href="#q-覆盖率上传失败" aria-hidden="true">#</a> Q: 覆盖率上传失败？</h3><p>A: 检查 <code>CODECOV_TOKEN</code> 是否正确配置</p><h3 id="q-覆盖率显示0" tabindex="-1"><a class="header-anchor" href="#q-覆盖率显示0" aria-hidden="true">#</a> Q: 覆盖率显示0%？</h3><p>A: 确认测试有运行，检查jacoco.xml路径</p><h3 id="q-如何提高覆盖率" tabindex="-1"><a class="header-anchor" href="#q-如何提高覆盖率" aria-hidden="true">#</a> Q: 如何提高覆盖率？</h3><p>A:</p><ol><li>为核心逻辑添加单元测试</li><li>使用Mockito模拟依赖</li><li>增加边界条件测试</li><li>添加集成测试</li></ol><h3 id="q-需要100-覆盖率吗" tabindex="-1"><a class="header-anchor" href="#q-需要100-覆盖率吗" aria-hidden="true">#</a> Q: 需要100%覆盖率吗？</h3><p>A: 不需要。70-80%是合理目标，过度追求覆盖率反而降低效率。</p><h2 id="高级功能" tabindex="-1"><a class="header-anchor" href="#高级功能" aria-hidden="true">#</a> 高级功能</h2><h3 id="_1-覆盖率趋势图" tabindex="-1"><a class="header-anchor" href="#_1-覆盖率趋势图" aria-hidden="true">#</a> 1. 覆盖率趋势图</h3><p>Codecov自动生成覆盖率趋势，可查看代码质量变化</p><h3 id="_2-文件级覆盖率" tabindex="-1"><a class="header-anchor" href="#_2-文件级覆盖率" aria-hidden="true">#</a> 2. 文件级覆盖率</h3><p>点击Codecov报告可查看每个文件的覆盖率</p><h3 id="_3-pr阻塞" tabindex="-1"><a class="header-anchor" href="#_3-pr阻塞" aria-hidden="true">#</a> 3. PR阻塞</h3><p>配置覆盖率下降超过阈值时阻止合并:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># codecov.yml</span>
<span class="token key atrule">coverage</span><span class="token punctuation">:</span>
  <span class="token key atrule">status</span><span class="token punctuation">:</span>
    <span class="token key atrule">project</span><span class="token punctuation">:</span>
      <span class="token key atrule">default</span><span class="token punctuation">:</span>
        <span class="token key atrule">target</span><span class="token punctuation">:</span> auto
        <span class="token key atrule">threshold</span><span class="token punctuation">:</span> 1%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考链接" tabindex="-1"><a class="header-anchor" href="#参考链接" aria-hidden="true">#</a> 参考链接</h2><ul><li>JaCoCo文档: https://www.jacoco.org/jacoco/</li><li>Codecov文档: https://docs.codecov.com/</li><li>GitHub Actions市场: https://github.com/marketplace/actions/codecov</li></ul>`,69),i=[l];function c(p,o){return n(),s("div",null,i)}const u=a(e,[["render",c],["__file","COVERAGE.html.vue"]]);export{u as default};
